<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.goodee.app.product.ProductDAO">
  
  	<select id="getList" resultType="ProductDTO" parameterType="com.goodee.app.util.Pager">
  		SELECT * FROM 
			(
				SELECT ROWNUM R, B.* FROM
				(
					SELECT * FROM PRODUCT_INFO
					<where>
						<choose>
							<when test="kind=='k2'">
								PRODUCT_EX LIKE '%'||#{search}||'%'
							</when>
							<otherwise>
								AND PRODUCT_NAME LIKE '%'||#{search}||'%'
							</otherwise>
						</choose>
					</where> 
					ORDER BY PRODUCT_NUM DESC) B)
					WHERE R	BETWEEN #{startRow} AND #{lastRow}
  	</select>
  	
  	<select id="getTotalCount" resultType="java.lang.Long" parameterType="com.goodee.app.util.Pager">
  		SELECT COUNT(PRODUCT_NUM) FROM PRODUCT_INFO
  		<where>
			<choose>
				<when test="kind=='k2'">
					PRODUCT_EX LIKE '%'||#{search}||'%'
				</when>
				<otherwise>
					AND PRODUCT_NAME LIKE '%'||#{search}||'%'
				</otherwise>
			</choose>
		</where> 
  	</select>

  	<select id="getDetail" resultType="ProductDTO" parameterType="ProductDTO">
  		SELECT * FROM PRODUCT_INFO WHERE PRODUCT_NUM = #{product_num}
  	</select>
  	
  	<insert id="add" parameterType="ProductDTO">
  		INSERT INTO PRODUCT_INFO VALUES (#{product_num},#{product_name},#{product_rate},#{product_ex})
  	</insert>
  	
  	<delete id="delete" parameterType="ProductDTO">
  		DELETE PRODUCT_INFO WHERE PRODUCT_NUM =#{product_num}
  	</delete>
  	
  	<update id="update" parameterType="ProductDTO">
  		UPDATE PRODUCT_INFO SET PRODUCT_NAME =#{product_name}, PRODUCT_RATE =#{product_rate}, PRODUCT_EX =#{product_ex}
  		WHERE PRODUCT_NUM = #{product_num}
  	</update>
  	
   	<!-- File Table에 집어넣을 insert쿼리문 -->
   	<select id="getNum" resultType="Long">
   		SELECT PRODUCT_SEQ.NEXTVAL FROM DUAL
   	</select>
   	
  	<insert id="addFile" parameterType="ProductFileDTO">
  		INSERT INTO
  		PRODUCT_FILES (FILE_NUM, PRODUCT_NUM, FILE_NAME, ORI_NAME)
		VALUES (FILES_SEQ.NEXTVAL, #{product_num}, #{file_name}, #{ori_name})
  	</insert>
  	
 
  </mapper>